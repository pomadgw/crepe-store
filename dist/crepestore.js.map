{"version":3,"file":"crepestore.js","sources":["webpack:///webpack/bootstrap 359e46b6f71bc2cf230d","webpack:///src/crepestore.js","webpack:///../~/private-parts/index.js","webpack:///src/main.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 359e46b6f71bc2cf230d","// Copyright (c) 2017 Rahadian Yusuf\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// I want private methods and instances\nvar _ = require('private-parts').createKey();\n\nfunction isDefined(variable) {\n  return variable != null;\n}\n\nexport default class CrepeStore {\n  constructor({ state = {}, mutations, actions, getters, modules = {}, debug = false } = {}, parent) {\n    // Initialize everything we needed here\n    _(this).mutations = {};\n    _(this).actions = {};\n    _(this).listeners = [];\n    _(this).getters = {};\n\n    // initialize inital state (if any) and debug mode\n    _(this).state = state;\n    _(this).debug = debug;\n    _(this).parent = parent;\n\n    // This function is to publish changes to\n    // all listeners. If the store has parent\n    // (i.e. it is a module), propagate it to\n    // its parent.\n    _(this).publish = function publish(obj = this) {\n      _(obj).listeners.forEach( (e) => {\n        e(obj);\n      });\n      if (isDefined(_(obj).parent)) {\n        _(this).publish(obj.parent);\n      }\n    }\n\n    _(this).executeOnAllModules = (fn) => {\n      let obj = _(this).state;\n      for (let key in obj) {\n        if(obj.hasOwnProperty(key) && obj[key] instanceof CrepeStore) {\n          fn(obj[key]);\n        }\n      }\n    }\n\n    function onExistsObjVariable(obj, action) {\n      if (obj !== undefined) {\n        for (let key in obj) {\n          if(obj.hasOwnProperty(key)) {\n            action(key);\n          }\n        }\n      }\n    }\n\n    // what if mutations are already defined in params?\n    onExistsObjVariable(mutations, (key) => {\n      this.addMutation({ type: key, fn: mutations[key] });\n    });\n\n    // what if actions are also already defined in params?\n    onExistsObjVariable(actions, (key) => {\n      this.addAction({ type: key, fn: actions[key] });\n    });\n\n    // what if getters are also already defined in params?\n    onExistsObjVariable(getters, (key) => {\n      this.addGetter({ name: key, fn: getters[key] });\n    });\n\n    onExistsObjVariable(modules, (key) => {\n      _(this).state[key] = new CrepeStore(modules[key], this);\n    })\n  }\n\n  // This method add mutation function,\n  // which is intended to mutate state\n  addMutation({ type, fn }) {\n    _(this).mutations[type] = (function(...args) {\n      fn(_(this).state, ...args)\n    }).bind(this);\n  }\n\n  // This method add action, which\n  // do something to state (including mutating it)\n  addAction({ type, fn }) {\n    _(this).actions[type] = (function(...args) {\n      let parent = _(this).parent;\n      let context = {\n        commit: this.commit\n      }\n      if(isDefined(parent)) {\n        Object.assign(context, {\n          state: _(this).state,\n          rootState: _(this).parent.state\n        });\n      }\n      fn(context, ...args);\n    }).bind(this);\n  }\n\n  // This function add a getter function to getter object\n  addGetter({ name, fn }) {\n    Object.defineProperty(_(this).getters, name, { get: () => fn(_(this).state) });\n  }\n\n  // Here is what you should call to mutate the state.\n  get commit() {\n    // I make it a getter so that\n    // adding action with function signature\n    // `function({ commit })` works (blatantly inspired by Vuex)\n    let fn = (function commit(type, ...args) {\n      _(this).mutations[type](...args);\n      _(this).publish();\n    }).bind(this);\n\n    return fn;\n  }\n\n  get getters() {\n    return _(this).getters;\n  }\n\n  get state() {\n    let $state = {};\n    let obj = _(this).state;\n    for (let key in obj) {\n      if(obj.hasOwnProperty(key)) {\n        Object.defineProperty($state, key, { get: () => obj[key] });\n      }\n    }\n    return $state;\n  }\n\n  // Here is what you should call to do actions on state\n  dispatch(type, ...args) {\n    _(this).actions[type](...args);\n  }\n\n  // Register a function that watch changes on\n  // state. This method will return a function\n  // to remove the added listener from store.\n  // Blatantly inspired by Redux\n  subscribe(fn) {\n    _(this).listeners.push(fn);\n\n    var unsub = () => {\n      const len = _(this).listeners.length;\n      for(var i = 0; i < len; i++) {\n        listener = _(this).listeners[i];\n\n        if (fn == listener) {\n          let left = _(this).listeners.slice(0, i);\n          let right = _(this).listeners.slice(i + 1, len);\n          _(this).listener = [...left, ...right];\n          break;\n        }\n      }\n    }\n\n    // Initialize publish to new subscriber\n    fn(this);\n    _(this).executeOnAllModules(fn);\n\n    return unsub;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// src/crepestore.js","/**\n * A function that returns a function that allows you to associate\n * a public object with its private counterpart.\n * @param {Function|Object} factory An optional argument that, is present, will\n *   be used to create new objects in the store.\n *   If factory is a function, it will be invoked with the key as an argument\n *   and the return value will be the private instance.\n *   If factory is an object, the private instance will be a new object with\n *   factory as it's prototype.\n */\nfunction createKey(factory){\n\n  // Create the factory based on the type of object passed.\n  factory = typeof factory == 'function'\n    ? factory\n    : createBound(factory);\n\n  // Store is used to map public objects to private objects.\n  var store = new WeakMap();\n\n  // Seen is used to track existing private objects.\n  var seen = new WeakMap();\n\n  /**\n   * An accessor function to get private instances from the store.\n   * @param {Object} key The public object that is associated with a private\n   *   object in the store.\n   */\n  return function(key) {\n    if (typeof key != 'object') return;\n\n    var value = store.get(key);\n    if (!value) {\n      // Make sure key isn't already the private instance of some existing key.\n      // This check helps prevent accidental double privatizing.\n      if (seen.has(key)) {\n        value = key;\n      } else {\n        value = factory(key);\n        store.set(key, value);\n        seen.set(value, true);\n      }\n    }\n    return value;\n  };\n}\n\n/**\n * Function.prototype.bind doesn't work in PhantomJS or Safari 5.1,\n * so we have to manually bind until support is dropped.\n * This function is effectively `Object.create.bind(null, obj, {})`\n * @param {Object} obj The first bound parameter to `Object.create`\n * @return {Function} The bound function.\n */\nfunction createBound(obj) {\n  return function() {\n    return Object.create(obj || Object.prototype);\n  };\n}\n\nmodule.exports = {\n  createKey: createKey\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/private-parts/index.js\n// module id = 1\n// module chunks = 0 1","window.CrepeStore = require('./crepestore').default;\n\n\n\n// WEBPACK FOOTER //\n// src/main.js"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;;;;;;;;;;;;;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AADA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAXA;AAAA;AAAA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAAA;AACA;AADA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;AA2BA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AA1DA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAHA;AAIA;AACA;AAAA;AAAA;AACA;AANA;AACA;AAEA;AAAA;AAIA;AACA;AACA;;;;;;AA1HA;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC9DA;;;A","sourceRoot":""}